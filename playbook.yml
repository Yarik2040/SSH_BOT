- name: Start Bot
  hosts: all    
  become: yes   

  tasks:        
  - name: Update and Install Pack
    shell: sudo apt-get update && sudo apt-get install ca-certificates curl

  - name: Install keyrings
    shell: sudo install -m 0755 -d /etc/apt/keyrings && sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc && sudo chmod a+r /etc/apt/keyrings/docker.asc

  - name: Add Source
    shell: echo  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu  $(. /etc/os-release && echo "$VERSION_CODENAME") stable" |  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null && sudo apt-get update

  - name: Install Docker
    shell: sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

  - name: Git Clone
    git:
      repo: https://github.com/Yarik2040/SSH_BOT.git
      dest: /bot
      clone: yes
      version: docker

  - name: Copy .env file
    copy:
      src: ../.env
      dest: /bot/bot/.env

  - name: docker compose build
    become: True
    shell:
      cmd: "docker compose build"
      chdir: /bot/

  - name: docker compose up -d
    become: True
    shell:
      cmd: "docker compose up -d"
      chdir: /bot/